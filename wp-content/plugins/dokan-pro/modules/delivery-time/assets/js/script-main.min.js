(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(t,o){if(t){if("string"==typeof t)return e(t,o);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,o):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o,n,r;o=jQuery,n={init:function(){o(".delivery-time-slot-picker").hide(),o(".store-pickup-select-options .store-address").hide(),o(".delivery-time-date-picker").on("change",n.delivery_type_selector_handler),n.init_calendar()},delivery_type_selector_handler:function(e){e.preventDefault();var t=o(e.target),r=t.data("vendor_id"),a={vendor_id:r,nonce:t.data("nonce"),selected_date:t.attr("value")};n.get_delivery_time_slots(a),n.get_store_pickup_locations(a),"delivery"===o("#dokan-selected-delivery-type-".concat(r)).val()&&o("#delivery-store-location-picker-".concat(r)).hide()},get_store_pickup_locations:function(e){var t={action:"dokan_store_location_get_items",vendor_id:e.vendor_id,nonce:e.nonce};e.selected_date?(o("#delivery-store-location-picker-".concat(e.vendor_id)).fadeIn(400),o("#dokan-spinner-overlay").fadeIn(100),jQuery.post(dokan.ajaxurl,t,(function(e){e.success&&(o("#dokan-spinner-overlay").fadeOut(400),o("#delivery-store-location-picker-".concat(t.vendor_id," option:gt(0)")).remove(),o.each(e.data.vendor_store_locations,(function(e,n){var a=r.get_store_location_info_from_formatted_string(n).name;o("#delivery-store-location-picker-".concat(t.vendor_id)).append(o("<option></option>").attr("value",n).text(a))})))}))):o("#delivery-store-location-picker-".concat(e.vendor_id)).fadeOut(400)},get_delivery_time_slots:function(e){e.selected_date?o("#delivery-time-slot-picker-".concat(e.vendor_id)).fadeIn(400):o("#delivery-time-slot-picker-".concat(e.vendor_id)).fadeOut(400),o("#delivery-time-slot-picker-".concat(e.vendor_id)).val(o("#delivery-time-slot-picker-".concat(e.vendor_id," option:first")).val());var t={action:"dokan_get_delivery_time_slot",vendor_id:e.vendor_id,nonce:e.nonce,date:e.selected_date};t.date&&n.get_delivery_time_slots_data(t)},get_delivery_time_slots_data:function(e){o("#dokan-spinner-overlay").fadeIn(100),jQuery.post(dokan.ajaxurl,e,(function(t){t.success&&(o("#dokan-spinner-overlay").fadeOut(400),o("#delivery-time-slot-picker-".concat(e.vendor_id," option:gt(0)")).remove(),o.each(t.data.vendor_delivery_slots,(function(t,n){var r=dokan_get_formatted_time(n.start,dokan_get_i18n_time_format(),"hh:mm a"),a=dokan_get_formatted_time(n.end,dokan_get_i18n_time_format(),"hh:mm a");o("#delivery-time-slot-picker-".concat(e.vendor_id)).append(o("<option></option>").attr("value",t).text("".concat(r," - ").concat(a)))})))}))},init_calendar:function(){if("undefined"!=typeof dokan_delivery_time_infos){var e=dokan_delivery_time_infos,o={disable:[],minDate:"today",altInput:!0,altFormat:dokan_helper.i18n_date_format.replace("jS","J"),dateFormat:"Y-m-d",locale:dokan_flatpickr_i18n},n="",r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];Object.keys(e.vendor_data).forEach((function(a){var i,d=null===(i=e.vendor_data[a].vendor_delivery_options)||void 0===i?void 0:i.delivery_day,c=void 0!==d?Object.entries(d).map((function(e){return parseInt(e[1])||e[0]===e[1]?e[0]:""})).filter((function(e){return null!==e?e:""})):[];if(c.length){n=c;var l=[];r.forEach((function(e){n.includes(e)||l.push(r.indexOf(e))})),o.disableDays=[function(e){return l.includes(e.getDay())}],o.disable=t(o.disableDays);var s=e.vendor_data[a].vendor_vacation_days,_=e.vendor_data[a].vendor_preorder_blocked_dates;o.disable=[].concat(t(o.disableDays),t(s),t(_)),delete o.disableDays,flatpickr("#delivery-time-date-picker-"+a,o)}}))}}},r={init:function(){o(".dokan-store-location-selector").length&&this.trigger_store_location_pickup()},trigger_store_location_pickup:function(){o(".dokan-store-location-selector .selector-wrapper .selector").on("click",(function(e){var t=o(this).data("selector"),n=o(this).data("vendor_id"),r=o("#dokan-delivery-selector-".concat(n)),a=o("#dokan-store-pickup-selector-".concat(n)),i=o("#dokan-selected-delivery-type-".concat(n));o("#dokan-spinner-overlay").fadeIn(100),a.removeClass("active-selector"),r.removeClass("active-selector"),o(this).hasClass("active-selector")||(o(this).addClass("active-selector"),o("#dokan-spinner-overlay").fadeOut(400)),i.val(t),"delivery"===t?(o("#delivery-store-location-picker-".concat(n)).fadeOut(),o("#delivery-store-location-address-".concat(n)).parent().fadeOut()):"store-pickup"===t&&(o("#delivery-store-location-picker-".concat(n)).fadeIn(),o("#delivery-store-location-picker-".concat(n)).val()&&o("#delivery-store-location-address-".concat(n)).parent().fadeIn())})),o(".delivery-store-location-picker").on("change",(function(e){var t=o(this).data("vendor_id"),n=o("#delivery-store-location-address-".concat(t)),a=r.get_store_location_info_from_formatted_string(this.value).address;n.parent().fadeIn(),n.html(a)}))},get_store_location_info_from_formatted_string:function(e){return e?{name:e.split("(")[0],address:e.match(/\((.*?)\)/)[1]}:{name:"",address:""}}},jQuery(document).ready((function(e){r.init(),n.init()}))})();